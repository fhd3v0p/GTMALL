# ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç: GTM Deployment Configuration

## üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ:

#### üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
@GTMALL/
‚îú‚îÄ‚îÄ ü§ñ bot/                    # Telegram Bot (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ üîå api/                    # API Server (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ üåê web/                    # Flutter Web App (–≥–æ—Ç–æ–≤–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ üîí traefik/                # Traefik Configuration (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ üìã docker-compose.yml      # –û—Å–Ω–æ–≤–Ω–æ–π compose —Ñ–∞–π–ª (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ üìã env.example            # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≥–æ—Ç–æ–≤–æ)
‚îú‚îÄ‚îÄ üìã deploy.sh              # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è (–≥–æ—Ç–æ–≤–æ)
‚îî‚îÄ‚îÄ üìã setup.sh               # –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≥–æ—Ç–æ–≤–æ)
```

#### üîç –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ **–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ .env**
- ‚úÖ **–ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ –∫–æ–¥–µ**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω—ã**
- ‚ö†Ô∏è **2 –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è**

#### üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: SSL, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, rate limiting
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Traefik Dashboard —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: API –Ω–∞ `api.gtm.baby`, Dashboard –Ω–∞ `traefik.gtm.baby`

## ‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. SUPABASE_SERVICE_ROLE_KEY
```bash
# –¢–µ–∫—É—â–µ–µ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å (–ø–æ–ª—É—á–∏—Ç—å –∏–∑ Supabase Dashboard):
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4bXRvdnF4anN2b2d5eXd5cmhhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDUyODU1MCwiZXhwIjoyMDcwMTA0NTUwfQ.actual_service_role_key
```

### 2. TRAEFIK_DASHBOARD_AUTH
```bash
# –¢–µ–∫—É—â–µ–µ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
TRAEFIK_DASHBOARD_AUTH=admin:your_secure_password_here

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å (—Å–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å):
TRAEFIK_DASHBOARD_AUTH=admin:gtm_secure_2024_password
```

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä 31.56.46.46

### üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:
- ‚ùå **–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: ping timeout
- ‚ùå **SSH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: connection timeout
- ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

### üîß SSH –∫–ª—é—á–∏ –Ω–∞–π–¥–µ–Ω—ã:
- ‚úÖ `~/.ssh/id_rsa_31_56`
- ‚úÖ `~/.ssh/id_ed25519_31_56`
- ‚úÖ `~/.ssh/id_rsa_31_56_new`

### üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞**: `ping 31.56.46.46`
2. **SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: `ssh -i ~/.ssh/id_rsa_31_56 root@31.56.46.46`
3. **DNS –∑–∞–ø–∏—Å–∏**: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –¥–æ–º–µ–Ω–∞ gtm.baby
4. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ `traefik/ssl/gtm.baby-ssl-bundle/`

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
cd @GTMALL
chmod +x setup.sh
./setup.sh
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
```bash
cp env.example .env
nano .env
# –ò–∑–º–µ–Ω–∏—Ç—å SUPABASE_SERVICE_ROLE_KEY –∏ TRAEFIK_DASHBOARD_AUTH
```

### 3. –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
chmod +x deploy.sh
./deploy.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl https://api.gtm.baby/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Traefik Dashboard
curl https://traefik.gtm.baby

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f
```

## üåê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```
Internet
    ‚Üì
Traefik (SSL/Proxy)
    ‚Üì
‚îú‚îÄ‚îÄ API Server (Flask + Gunicorn) ‚Üí https://api.gtm.baby
‚îú‚îÄ‚îÄ Telegram Bot (python-telegram-bot)
‚îú‚îÄ‚îÄ Redis (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îî‚îÄ‚îÄ Web App (Flutter) ‚Üí https://gtm.baby
    ‚Üì
Supabase (Database + Storage)
```

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

- **API**: `https://api.gtm.baby`
  - Health: `https://api.gtm.baby/api/health`
  - Subscription: `https://api.gtm.baby/api/check_subscription`
  - Tickets: `https://api.gtm.baby/api/user_tickets/<id>`

- **Traefik Dashboard**: `https://traefik.gtm.baby`
  - –õ–æ–≥–∏–Ω: `admin`
  - –ü–∞—Ä–æ–ª—å: –∏–∑ `TRAEFIK_DASHBOARD_AUTH`

- **Web App**: `https://gtm.baby` (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ Rate limiting
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è dashboard
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é:
- ‚úÖ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ API: `docker-compose up --scale api=3`
- ‚úÖ Redis –∫–ª–∞—Å—Ç–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ PostgreSQL —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Traefik Dashboard
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
ping 31.56.46.46

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH
ssh -i ~/.ssh/id_rsa_31_56 root@31.56.46.46
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS:
```
gtm.baby          A    31.56.46.46
api.gtm.baby      A    31.56.46.46
traefik.gtm.baby  A    31.56.46.46
```

### 3. –ü–æ–ª—É—á–∏—Ç—å Supabase Service Role Key:
1. Supabase Dashboard ‚Üí Settings ‚Üí API
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å "service_role" key
3. –û–±–Ω–æ–≤–∏—Ç—å –≤ .env —Ñ–∞–π–ª–µ

### 4. –°–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å:
```bash
openssl rand -base64 32
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π:
```bash
cd @GTMALL
./deploy.sh
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞—è –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è GTM**

- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: SSL, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, rate limiting
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Traefik Dashboard, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç—É**: –û–¥–∏–Ω –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: Docker, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏, health checks

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é! üöÄ**

---

### üìã –§–∞–π–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
- `bot_main.py` ‚Üí `@GTMALL/bot/`
- `supabase_client.py` ‚Üí `@GTMALL/bot/` –∏ `@GTMALL/api/`
- `webapp_handler.py` ‚Üí `@GTMALL/bot/`
- `api_server.py` ‚Üí `@GTMALL/api/`

### üîß –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. `SUPABASE_SERVICE_ROLE_KEY` - –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Supabase Dashboard
2. `TRAEFIK_DASHBOARD_AUTH` - —Å–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å 