#!/bin/bash

echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤..."
echo "============================================="

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞—Ä–æ–π –ø–∞–ø–∫–∏
if [ -d "/root/gtmall/gtm.baby-ssl-bundle" ]; then
    echo "üìÅ –ù–∞–π–¥–µ–Ω–∞ –ø–∞–ø–∫–∞ gtm.baby-ssl-bundle"
    
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
    docker-compose -f docker-compose-fixed.yml down
    
    # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–∞–ø–∫—É
    echo "üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –ø–∞–ø–∫—É..."
    mv /root/gtmall/gtm.baby-ssl-bundle /root/gtmall/ssl
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:"
    ls -la /root/gtmall/ssl/
    
    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    echo "üìù –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é..."
    cp traefik/traefik-final.yml traefik/traefik.yml
    
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π..."
    docker-compose -f docker-compose-fixed.yml up -d
    
    # –ñ–¥–∞—Ç—å –∑–∞–ø—É—Å–∫–∞
    echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞..."
    sleep 10
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:"
    docker-compose -f docker-compose-fixed.yml ps
    
    echo ""
    echo "‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
    echo "üåê –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://gtm.baby"
else
    echo "‚ùå –ü–∞–ø–∫–∞ gtm.baby-ssl-bundle –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "üìÅ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ /root/gtmall/:"
    ls -la /root/gtmall/
fi 