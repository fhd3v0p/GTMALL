# üìä –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è GTM

## üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Telegram Bot (`bot_main.py`)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `python-telegram-bot==20.6` - Telegram Bot API
- `psycopg2-binary==2.9.7` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `redis==4.6.0` - Redis –∫–ª–∏–µ–Ω—Ç
- `python-dotenv==1.0.0` - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `requests==2.31.0` - HTTP –∫–ª–∏–µ–Ω—Ç
- `aiohttp==3.9.1` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `TELEGRAM_BOT_TOKEN` - –¢–æ–∫–µ–Ω –±–æ—Ç–∞
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `REDIS_URL` - URL Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `SUPABASE_URL` - URL Supabase
- `SUPABASE_ANON_KEY` - –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á Supabase
- `SUPABASE_SERVICE_ROLE_KEY` - –°–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á Supabase
- `TELEGRAM_FOLDER_LINK` - –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–ø–∫—É Telegram
- `WEBAPP_URL` - URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∫–∞–Ω–∞–ª—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
- WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### API Server (`api_server.py`)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `flask==2.3.3` - –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- `flask-cors==4.0.0` - CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- `python-telegram-bot==20.7` - Telegram Bot API
- `python-dotenv==1.0.0` - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `requests==2.31.0` - HTTP –∫–ª–∏–µ–Ω—Ç
- `psycopg2-binary==2.9.9` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `redis==5.0.1` - Redis –∫–ª–∏–µ–Ω—Ç
- `gunicorn==21.2.0` - WSGI —Å–µ—Ä–≤–µ—Ä

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `API_PORT` - –ü–æ—Ä—Ç API (5000)
- `API_HOST` - –•–æ—Å—Ç API (0.0.0.0)
- `FLASK_ENV` - –û–∫—Ä—É–∂–µ–Ω–∏–µ Flask
- `SUPABASE_URL` - URL Supabase
- `SUPABASE_ANON_KEY` - –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á Supabase
- `SUPABASE_SERVICE_ROLE_KEY` - –°–µ—Ä–≤–∏—Å–Ω—ã–π –∫–ª—é—á Supabase
- `TELEGRAM_BOT_TOKEN` - –¢–æ–∫–µ–Ω –±–æ—Ç–∞
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `REDIS_URL` - URL Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `POST /api/check_subscription` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- `GET /api/user_tickets/<telegram_id>` - –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/total_tickets_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–ª–µ—Ç–æ–≤
- `POST /api/telegram_bot/check` - –í—ã–∑–æ–≤ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### Supabase Client (`supabase_client.py`)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–∞–º–∏
- –†–∞–±–æ—Ç–∞ —Å –∞—Ä—Ç–∏—Å—Ç–∞–º–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Storage
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Supabase –ø—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –¢–∞–±–ª–∏—Ü—ã: `users`, `subscriptions`, `artists`, `artist_gallery`
- Storage bucket: `gtm-assets-public`

## üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–µ—Ç—å
- `traefik` - –≤–Ω–µ—à–Ω—è—è —Å–µ—Ç—å –¥–ª—è Traefik

### Volumes
- `traefik_acme` - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- `traefik_logs` - –õ–æ–≥–∏ Traefik
- `redis_data` - –î–∞–Ω–Ω—ã–µ Redis
- `postgres_data` - –î–∞–Ω–Ω—ã–µ PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü–æ—Ä—Ç—ã
- `80` - HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS)
- `443` - HTTPS
- `8080` - Traefik Dashboard

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Traefik Middleware
- `secure-headers` - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- `cors` - CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `rate-limit` - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `auth` - –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è dashboard

### SSL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Let's Encrypt
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ `traefik/ssl/`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Checks
- API: `https://api.gtm.baby/api/health`
- Traefik Dashboard: `https://traefik.gtm.baby`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Traefik: `/var/log/traefik/`
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è: Docker logs

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. Docker –∏ Docker Compose
2. –î–æ–º–µ–Ω `gtm.baby` —Å DNS –∑–∞–ø–∏—Å—è–º–∏:
   - `gtm.baby` ‚Üí —Å–µ—Ä–≤–µ—Ä
   - `api.gtm.baby` ‚Üí —Å–µ—Ä–≤–µ—Ä
   - `traefik.gtm.baby` ‚Üí —Å–µ—Ä–≤–µ—Ä
3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å `./setup.sh`
3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `.env`
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å `docker-compose up -d`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `docker-compose ps`

## üîß –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- API: `docker-compose up --scale api=3`
- Redis –∫–ª–∞—Å—Ç–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- PostgreSQL —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Gunicorn workers
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **Supabase**: –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, PostgreSQL –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
2. **Redis**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
3. **Traefik**: –û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –∏ SSL
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ç–æ–≤–∞ –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ rate limiting 