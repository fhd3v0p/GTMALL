# üöÄ GTM Nginx Deployment Report

## üìã –û–±–∑–æ—Ä

–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ gtm.baby —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ `nginx.conf` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx
- ‚úÖ `docker-compose-simple.yml` - Docker Compose –¥–ª—è nginx
- ‚úÖ `web/` - Flutter web —Ñ–∞–π–ª—ã
- ‚úÖ `gtm.baby-ssl-bundle/` - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úÖ `api/` - API —Å–µ—Ä–≤–µ—Ä
- ‚úÖ `database/` - PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `bot/` - Telegram –±–æ—Ç

### 2. üîí SSL –ù–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã
- ‚úÖ –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è: 3 –Ω–æ—è–±—Ä—è 2025
- ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (600 –¥–ª—è –∫–ª—é—á–∞, 644 –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞)

### 3. üåê Nginx –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ HTTP -> HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
- ‚úÖ SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ Gzip —Å–∂–∞—Ç–∏–µ
- ‚úÖ Rate limiting
- ‚úÖ Security headers
- ‚úÖ API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ Flutter SPA –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### 4. üê≥ Docker –ù–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ Nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- ‚úÖ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- ‚úÖ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- ‚úÖ Redis –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- ‚úÖ Health checks
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ URL

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:

| URL | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----|----------|--------|
| https://gtm.baby | –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç | ‚úÖ |
| https://www.gtm.baby | WWW –≤–µ—Ä—Å–∏—è | ‚úÖ |
| https://api.gtm.baby | API —Å–µ—Ä–≤–µ—Ä | ‚úÖ |
| https://gtm.baby/admin/ | –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å | ‚úÖ |
| https://gtm.baby/health | Health check | ‚úÖ |

## üîß –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
```bash
./check-nginx-config.sh
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL:
```bash
./setup-ssl.sh
```

### –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
./deploy-to-server.sh <SERVER_IP> [SSH_KEY_PATH]
```

### –î–µ–ø–ª–æ–π –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
./deploy-nginx.sh
```

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
ssh -i ~/.ssh/id_rsa_46.203.233.218 root@31.56.39.165 'cd /root/gtm-nginx && docker-compose -f docker-compose-simple.yml ps'
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# Nginx –ª–æ–≥–∏
ssh -i ~/.ssh/id_rsa_46.203.233.218 root@31.56.39.165 'cd /root/gtm-nginx && docker-compose -f docker-compose-simple.yml logs nginx'

# API –ª–æ–≥–∏
ssh -i ~/.ssh/id_rsa_46.203.233.218 root@31.56.39.165 'cd /root/gtm-nginx && docker-compose -f docker-compose-simple.yml logs api'
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:
```bash
ssh -i ~/.ssh/id_rsa_46.203.233.218 root@31.56.39.165 'cd /root/gtm-nginx && docker-compose -f docker-compose-simple.yml restart'
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
ssh -i ~/.ssh/id_rsa_46.203.233.218 root@31.56.39.165 'cd /root/gtm-nginx && docker-compose -f docker-compose-simple.yml down'
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL:
```bash
openssl s_client -connect gtm.baby:443 -servername gtm.baby
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:
```bash
curl -I https://gtm.baby
curl -I https://api.gtm.baby/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:
```bash
curl -I http://gtm.baby
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 301 —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ Gzip —Å–∂–∞—Ç–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (1 –≥–æ–¥)
- ‚úÖ Rate limiting –¥–ª—è API (10 r/s)
- ‚úÖ Rate limiting –¥–ª—è web (30 r/s)
- ‚úÖ HTTP/2 –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ SSL session cache

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- ‚úÖ Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ—à–∏–±–æ–∫
- ‚úÖ Docker stats –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### SSL/TLS:
- ‚úÖ TLS 1.2 –∏ 1.3
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∏—Ñ—Ä—ã
- ‚úÖ HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏
- ‚úÖ OCSP stapling

### Security Headers:
- ‚úÖ X-Frame-Options
- ‚úÖ X-Content-Type-Options
- ‚úÖ X-XSS-Protection
- ‚úÖ Strict-Transport-Security
- ‚úÖ Referrer-Policy

### Rate Limiting:
- ‚úÖ API: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- ‚úÖ Web: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- ‚úÖ Burst protection

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä**:
   ```bash
   ./deploy-to-server.sh 31.56.39.165 ~/.ssh/id_rsa_46.203.233.218
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏**:
   - –û—Ç–∫—Ä—ã—Ç—å https://gtm.baby
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API: https://api.gtm.baby/health
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: https://gtm.baby/admin/

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   ```bash
   docker-compose -f docker-compose-simple.yml logs
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**:
   ```bash
   nginx -t
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL**:
   ```bash
   openssl x509 -in gtm.baby-ssl-bundle/domain.cert.pem -text -noout
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**:
   ```bash
   curl -I https://gtm.baby
   ```

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ

–í—Å–µ —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ Nginx —Å SSL
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Flutter web –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 