# ðŸ”¥ Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð¾Ð²: Flutter â†’ Bot API â†’ Supabase

## âœ… Ð§Ñ‚Ð¾ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾:

### ðŸ“± **Flutter:**
- â­ Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ¸ Ð´Ð»Ñ Ð¾Ñ†ÐµÐ½ÐºÐ¸
- ðŸ“¡ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· HTTP API
- ðŸ”„ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
- ðŸ’« ÐšÑ€Ð°ÑÐ¸Ð²Ð°Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸

### ðŸ¤– **Bot API:**
- ðŸš€ Flask API ÑÐµÑ€Ð²ÐµÑ€ (`rating_api.py`)
- ðŸ“ Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ `/api/rate-artist` Ð´Ð»Ñ Ð¿Ñ€Ð¸ÐµÐ¼Ð° Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð¾Ð²
- ðŸ“Š Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Supabase RPC Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸
- ðŸ”’ Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

## ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹:

### Ð¨Ð°Ð³ 1: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Supabase
Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ SQL Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° `add_rating_columns.sql` Ð² Supabase Dashboard:

```sql
-- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ Ð´Ð»Ñ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð°
ALTER TABLE artists ADD COLUMN IF NOT EXISTS average_rating DECIMAL(3,2) DEFAULT 0.0;
ALTER TABLE artists ADD COLUMN IF NOT EXISTS total_ratings INTEGER DEFAULT 0;

-- Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð¾Ð²
CREATE TABLE IF NOT EXISTS artist_ratings (
  id BIGSERIAL PRIMARY KEY,
  artist_id BIGINT REFERENCES artists(id) ON DELETE CASCADE,
  user_id TEXT NOT NULL,
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  UNIQUE(artist_id, user_id)
);

-- ... (Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð´ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð°)
```

### Ð¨Ð°Ð³ 2: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Rating API
```bash
cd gtm-prod1/bot

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (Ð² Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸)
python3 -m venv venv
source venv/bin/activate
pip install -r requirements_rating_api.txt

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ API ÑÐµÑ€Ð²ÐµÑ€
python3 rating_api.py
```

### Ð¨Ð°Ð³ 3: Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Flutter Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
```bash
# Ð’ ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
flutter run -d chrome --web-port=8080
```

## ðŸ”„ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:

```
ðŸ‘¤ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÐµÑ‚ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÑƒ Ð² Flutter
    â†“
ðŸ“± Flutter: POST /api/rate-artist
    â†“  
ðŸ¤– Rating API: Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ
    â†“
ðŸ“ API: Ð²Ñ‹Ð·Ñ‹Ð²Ð°ÐµÑ‚ RPC add_artist_rating Ð² Supabase
    â†“
ðŸ’¾ Supabase: ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¸ Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ€ÐµÐ´Ð½Ð¸Ð¹
    â†“
ðŸ“Š API: Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½ÑƒÑŽ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ
    â†“
ðŸ“± Flutter: Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ UI Ñ Ð½Ð¾Ð²Ñ‹Ð¼ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ð¾Ð¼
```

## ðŸ”§ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ:

### Ð”Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:
- Rating API: `http://localhost:5000`
- Flutter: `http://localhost:8080`

### Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ð°:
ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `lib/config/api_config.dart`:
```dart
static const String ratingApiBaseUrl = 'https://your-api-domain.com';
```

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:

### 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ API:
```bash
curl -X GET http://localhost:5000/api/health
```

### 2. Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³:
```bash
curl -X POST http://localhost:5000/api/rate-artist \
  -H "Content-Type: application/json" \
  -d '{
    "artist_name": "EMI",
    "user_id": "test_user_123",
    "rating": 5,
    "comment": "ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°!"
  }'
```

### 3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð² Flutter:
1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ðº Ð»ÑŽÐ±Ð¾Ð¼Ñƒ Ð°Ñ€Ñ‚Ð¸ÑÑ‚Ñƒ  
3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÑƒ
4. Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑŒÑÑ "âœ… Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð²Ð°ÑˆÑƒ Ð¾Ñ†ÐµÐ½ÐºÑƒ!"

## ðŸŽ¯ ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð½Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹:

1. **ðŸŽ¨ ÐšÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ UX** - Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸
2. **ðŸ”’ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** - Ð²ÑÐµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ API
3. **âš¡ Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ñ‚Ð°** - Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð°Ñ ÑÐ²ÑÐ·ÑŒ
4. **ðŸ“Š Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ** - Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ = Ð¾Ð´Ð½Ð° Ð¾Ñ†ÐµÐ½ÐºÐ°
5. **ðŸ”„ Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ** - Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð²ÑÐµÐ³Ð´Ð° Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹

**Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ! Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¸ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ.**